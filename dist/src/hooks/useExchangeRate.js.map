{"version":3,"file":"useExchangeRate.js","sourceRoot":"","sources":["../../../src/hooks/useExchangeRate.ts"],"names":[],"mappings":"AAMA,MAAM,OAAO,eAAe;IAS1B,YAAY,IAA4B,EAAE,QAAgB;QAJ1D,SAAI,GAAW,CAAC,CAAC;QACjB,YAAO,GAAY,KAAK,CAAC;QACzB,UAAK,GAAY,IAAI,CAAC;QAGpB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAE1B,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC;IAED;;qCAEiC;IAEjC,aAAa;QACX,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnB,IAAI,CAAC,SAAS,EAAE,CAAC;QACnB,CAAC;IACH,CAAC;IAED,gBAAgB;QACd,IAAI,CAAC,eAAe,EAAE,KAAK,EAAE,CAAC;IAChC,CAAC;IAED;;qCAEiC;IAEjC,IAAI,QAAQ,CAAC,KAAa;QACxB,IAAI,IAAI,CAAC,SAAS,KAAK,KAAK,EAAE,CAAC;YAC7B,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;YACvB,IAAI,CAAC,SAAS,EAAE,CAAC;QACnB,CAAC;IACH,CAAC;IAED,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,SAAS,CAAC;IACxB,CAAC;IAED,IAAI,SAAS;QACX,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC;IACrD,CAAC;IAED;;qCAEiC;IAEjC,KAAK,CAAC,SAAS;QACb,IAAI,CAAC,IAAI,CAAC,SAAS;YAAE,OAAO;QAE5B,IAAI,CAAC,eAAe,EAAE,KAAK,EAAE,CAAC;QAC9B,IAAI,CAAC,eAAe,GAAG,IAAI,eAAe,EAAE,CAAC;QAE7C,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;QAE1B,IAAI,CAAC;YACH,MAAM,GAAG,GAAG,MAAM,KAAK,CACrB,qDAAqD,IAAI,CAAC,SAAS,YAAY,EAC/E,EAAE,MAAM,EAAE,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CACxC,CAAC;YAEF,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC;gBACZ,MAAM,IAAI,KAAK,CAAC,QAAQ,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC;YACxC,CAAC;YAED,MAAM,IAAI,GAAyB,MAAM,GAAG,CAAC,IAAI,EAAE,CAAC;YACpD,IAAI,CAAC,IAAI,GAAG,IAAI,EAAE,GAAG,IAAI,CAAC,CAAC;QAC7B,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,IAAK,GAAW,EAAE,IAAI,KAAK,YAAY,EAAE,CAAC;gBACxC,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;gBACjB,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC;YAChB,CAAC;QACH,CAAC;gBAAS,CAAC;YACT,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;YACrB,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;QAC5B,CAAC;IACH,CAAC;IAED,OAAO;QACL,IAAI,CAAC,SAAS,EAAE,CAAC;IACnB,CAAC;CACF","sourcesContent":["import { ReactiveController, ReactiveControllerHost } from \"lit\";\n\ninterface ExchangeRateResponse {\n  USD: number; // 1 CRYPTO = X USD\n}\n\nexport class UseExchangeRate implements ReactiveController {\n  private host: ReactiveControllerHost;\n  private _currency: string;\n  private abortController?: AbortController;\n\n  rate: number = 0;\n  loading: boolean = false;\n  error: unknown = null;\n\n  constructor(host: ReactiveControllerHost, currency: string) {\n    this.host = host;\n    this._currency = currency;\n\n    host.addController(this);\n  }\n\n  /* ==============================\n     Lifecycle\n  ============================== */\n\n  hostConnected() {\n    if (this._currency) {\n      this.fetchRate();\n    }\n  }\n\n  hostDisconnected() {\n    this.abortController?.abort();\n  }\n\n  /* ==============================\n     Symbol Setter\n  ============================== */\n\n  set currency(value: string) {\n    if (this._currency !== value) {\n      this._currency = value;\n      this.fetchRate();\n    }\n  }\n\n  get currency() {\n    return this._currency;\n  }\n\n  get isSuccess() {\n    return !!this.rate && !this.loading && !this.error;\n  }\n\n  /* ==============================\n     Fetch Rate\n  ============================== */\n\n  async fetchRate() {\n    if (!this._currency) return;\n\n    this.abortController?.abort();\n    this.abortController = new AbortController();\n\n    this.loading = true;\n    this.error = null;\n    this.host.requestUpdate();\n\n    try {\n      const res = await fetch(\n        `https://min-api.cryptocompare.com/data/price?fsym=${this._currency}&tsyms=USD`,\n        { signal: this.abortController.signal },\n      );\n\n      if (!res.ok) {\n        throw new Error(`HTTP ${res.status}`);\n      }\n\n      const data: ExchangeRateResponse = await res.json();\n      this.rate = data?.USD ?? 0;\n    } catch (err) {\n      if ((err as any)?.name !== \"AbortError\") {\n        this.error = err;\n        this.rate = 0;\n      }\n    } finally {\n      this.loading = false;\n      this.host.requestUpdate();\n    }\n  }\n\n  refetch() {\n    this.fetchRate();\n  }\n}\n"]}