{"version":3,"file":"use-transactionbyid.js","sourceRoot":"","sources":["../../../src/hooks/use-transactionbyid.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,MAAM,EAAE,MAAM,cAAc,CAAC;AAOtC,MAAM,OAAO,qBAAqB;IAOhC,YAAY,IAA4B,EAAE,OAAgB;QACxD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAEzB,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QAExB,IAAI,CAAC,GAAG,GAAG,IAAI,MAAM,CACnB,IAAI,CAAC,IAAI,EACT,qCAAqC,EACrC;YACE,OAAO,EAAE,CAAC,CAAC,OAAO;YAClB,MAAM,EAAE,EAAE,OAAO,EAAE;SACpB,CACF,CAAC;IACJ,CAAC;IAED;;iCAE6B;IAE7B,gBAAgB;QACd,IAAI,CAAC,WAAW,EAAE,CAAC;IACrB,CAAC;IAED;;iCAE6B;IAE7B,IAAI,OAAO,CAAC,KAAyB;QACnC,IAAI,IAAI,CAAC,QAAQ,KAAK,KAAK;YAAE,OAAO;QAEpC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;QAE9B,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;QACvC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;QAE7B,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,IAAI,KAAK,EAAE,CAAC;YACV,IAAI,CAAC,YAAY,EAAE,CAAC;QACtB,CAAC;IACH,CAAC;IAED;;iCAE6B;IAErB,YAAY;QAClB,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE;YACxC,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,SAAS,KAAK,MAAM,EAAE,CAAC;gBACxC,IAAI,CAAC,WAAW,EAAE,CAAC;gBACnB,OAAO;YACT,CAAC;YAED,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,EAAE,KAAK,CAAC,CAAC;IACZ,CAAC;IAEO,WAAW;QACjB,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;YACpB,aAAa,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC/B,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;QAC9B,CAAC;IACH,CAAC;IAED;;iCAE6B;IAE7B,IAAI,IAAI;QACN,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC;IACvB,CAAC;IAED,IAAI,OAAO;QACT,OAAO,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC;IAC1B,CAAC;IAED,IAAI,KAAK;QACP,OAAO,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;IACxB,CAAC;IAED,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC;IACzB,CAAC;IAED,OAAO;QACL,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IACrB,CAAC;CACF","sourcesContent":["import { ReactiveController, ReactiveControllerHost } from \"lit\";\nimport { UseApi } from \"./use-api.js\";\n\ninterface TransactionResponse {\n  tx_status: string;\n  [key: string]: any;\n}\n\nexport class UseGetTransactionById implements ReactiveController {\n  private host: ReactiveControllerHost;\n  private intervalId?: number;\n  private _address?: string;\n\n  private api: UseApi<TransactionResponse>;\n\n  constructor(host: ReactiveControllerHost, address?: string) {\n    this.host = host;\n    host.addController(this);\n\n    this._address = address;\n\n    this.api = new UseApi<TransactionResponse>(\n      this.host,\n      \"orders/getTransactionByPaymentToken\",\n      {\n        enabled: !!address,\n        params: { address },\n      },\n    );\n  }\n\n  /* -------------------------\n     Lifecycle\n  -------------------------- */\n\n  hostDisconnected() {\n    this.stopPolling();\n  }\n\n  /* -------------------------\n     Address Setter\n  -------------------------- */\n\n  set address(value: string | undefined) {\n    if (this._address === value) return;\n\n    this._address = value;\n    console.log(value, \"value>>\");\n\n    this.api.setParams({ address: value });\n    this.api.setEnabled(!!value);\n\n    this.stopPolling();\n\n    if (value) {\n      this.startPolling();\n    }\n  }\n\n  /* -------------------------\n     Polling Logic\n  -------------------------- */\n\n  private startPolling() {\n    this.stopPolling();\n\n    this.intervalId = window.setInterval(() => {\n      if (this.api.data?.tx_status === \"paid\") {\n        this.stopPolling();\n        return;\n      }\n\n      this.api.refetch();\n    }, 10000);\n  }\n\n  private stopPolling() {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = undefined;\n    }\n  }\n\n  /* -------------------------\n     Expose API State\n  -------------------------- */\n\n  get data() {\n    return this.api.data;\n  }\n\n  get loading() {\n    return this.api.loading;\n  }\n\n  get error() {\n    return this.api.error;\n  }\n\n  get status() {\n    return this.api.status;\n  }\n\n  refetch() {\n    this.api.refetch();\n  }\n}\n"]}